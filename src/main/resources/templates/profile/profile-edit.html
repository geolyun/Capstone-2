<!--
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>프로필 수정</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div th:replace="~{layout/header :: header}"></div>

<main class="container mt-5">
    <h2>프로필 수정</h2>
    <hr>
    <div class="row">
        <div class="col-md-4 text-center">
            <img th:src="${profile.avatarUrl != null ? profile.avatarUrl : '/images/default-avatar.png'}"
                 id="image-preview" class="img-fluid rounded-circle mb-3" alt="프로필 이미지" style="width: 150px; height: 150px; object-fit: cover;">

            <input type="file" id="avatar-upload" class="visually-hidden" accept="image/*">

            <label for="avatar-upload" class="btn btn-secondary">이미지 변경</label>

            <div id="upload-status" class="form-text mt-2"></div>
        </div>

        <div class="col-md-8">
            <form th:action="@{/profile/me/edit}" method="post" th:object="${profile}">
                <input type="hidden" id="avatarUrl" th:field="*{avatarUrl}">

                <div class="mb-3">
                    <label for="displayName" class="form-label">표시용 이름</label>
                    <input type="text" id="displayName" th:field="*{displayName}" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="bio" class="form-label">자기소개</label>
                    <textarea id="bio" th:field="*{bio}" class="form-control" rows="5"></textarea>
                </div>

                <button type="submit" class="btn btn-primary">저장하기</button>
                <a th:href="@{/profile/me}" class="btn btn-secondary">취소</a>
            </form>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const imageUpload = document.getElementById('avatar-upload');
    const imagePreview = document.getElementById('image-preview');
    const hiddenUrlInput = document.getElementById('avatarUrl');
    const uploadStatus = document.getElementById('upload-status');

    imageUpload.addEventListener('change', async (event) => {
        const file = event.target.files[0];
        if (!file) {
            return;
        }

        const reader = new FileReader();
        reader.onload = (e) => {
            imagePreview.src = e.target.result;
        };
        reader.readAsDataURL(file);

        const formData = new FormData();
        formData.append('file', file);
        uploadStatus.textContent = '업로드 중...';

        try {
            const response = await fetch('/api/files/upload', {
                method: 'POST',
                body: formData,
            });

            if (!response.ok) {
                throw new Error('이미지 업로드에 실패했습니다.');
            }

            const result = await response.json();
            const imageUrl = result.url;

            hiddenUrlInput.value = imageUrl;
            uploadStatus.textContent = '업로드 성공!';

        } catch (error) {
            console.error('Upload error:', error);
            uploadStatus.textContent = '업로드 실패. 다시 시도해주세요.';
           }
    });
</script>
</body>
</html>-->

<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>프로필 수정</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div th:replace="~{layout/header :: header}"></div>

<main class="container mt-5">
    <h2>프로필 수정</h2>
    <hr>
    <form th:action="@{/profile/me/edit}" method="post" th:object="${profile}">
        <div class="mb-3">
            <label for="displayName" class="form-label">표시용 이름</label>
            <input type="text" id="displayName" th:field="*{displayName}" class="form-control" required>
        </div>
        <div class="mb-3">
            <label for="bio" class="form-label">자기소개</label>
            <textarea id="bio" th:field="*{bio}" class="form-control" rows="5"></textarea>
        </div>

        <button type="submit" class="btn btn-primary">저장하기</button>
        <a th:href="@{/profile/me}" class="btn btn-secondary">취소</a>
    </form>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
